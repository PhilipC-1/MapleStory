<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¼“ç®­æ‰‹</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
      color: #333;
      font-weight: bold;
      overflow-x: hidden;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    #floating-points {
      position: fixed;
      top: 100px;
      left: 20px;
      background: #fff;
      padding: 10px 20px;
      border: 2px solid #bbb;
      border-radius: 10px;
      font-size: 20px;
      z-index: 999;
    }
    #points-remaining {
      color: red;
    }
    .skill {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px #ccc;
      margin: 20px auto;
      max-width: 1000px;
      padding: 20px;
      position: relative;
    }
    .unlock-status {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 16px;
      font-weight: bold;
    }
    .unlock-status.locked {
      color: #a0522d;
    }
    .unlock-status.unlocked {
      color: green;
    }
    .skill-header {
      display: flex;
      align-items: center;
    }
    .skill-header img {
      width: 64px;
      height: 64px;
      margin-right: 15px;
    }
    .skill-header h2 {
      margin: 0;
    }
    .meta-table, .skill-table {
      width: auto;
      margin-left: 0;
      margin-right: auto;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .meta-table td, .skill-table td, .skill-table th {
      padding: 6px 10px;
      border: 1px solid #ccc;
      text-align: center;
      vertical-align: middle;
    }
    .meta-table td.label {
      background: #e6f5ff;
      width: 100px;
    }
    .effect-row td.label {
      background: #fff8dc;
    }
    .effect-row td.effect {
      background: #fff;
      white-space: pre-wrap;
    }
    .controls {
      margin-top: 15px;
      text-align: left; /* âœ… æ”¹ç‚ºé å·¦ */
    }
    button {
      font-size: 18px;
      padding: 5px 12px;
      margin: 0 5px;
      cursor: pointer;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: bold;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .skill-table th {
      background-color: #f3e6ff;
    }
    tr.highlight {
      background-color: #d4f0ff;
    }
  </style>
</head>
<body>
  <h1>å¼“ç®­æ‰‹</h1> <!-- âœ… ä¿®æ”¹æ¨™é¡Œ -->
  <div id="floating-points">å¯ç”¨æŠ€èƒ½é»æ•¸ï¼š<span id="points-remaining">61</span></div>
  <div id="skills-container"></div>

<script>
const MAX_POINTS = 61;
let usedPoints = 0;
let holdInterval = null;
let lastWarning = '';

const skills = [
  {
    name: "ç²¾æº–å¼·åŒ–",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01001.png",
    max_level: 16,
    type: "è¢«å‹•",
    prerequisite: "",
    description: "å¢åŠ å‘½ä¸­ç‡ã€‚",
    headers: ["æŠ€èƒ½ç­‰ç´š", "å‘½ä¸­ç‡"],
    levels: Array.from({ length: 16 }, (_, i) => [i + 1, `+${i + 1}`])
  },
  {
    name: "ç™¾æ­¥ç©¿æ¥Š",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01002.png",
    max_level: 8,
    type: "è¢«å‹•",
    prerequisite: "ç²¾æº–å¼·åŒ– LV3",
    description: "å¢åŠ å¼“æˆ–å¼©å¼“çš„å°„ç¨‹è·é›¢ã€‚",
    headers: ["æŠ€èƒ½ç­‰ç´š", "å°„ç¨‹"],
    levels: Array.from({ length: 8 }, (_, i) => [i + 1, `${25 * (i + 1)}%`])
  },
  {
    name: "éœ¸ç‹ç®­",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01003.png",
    max_level: 20,
    type: "è¢«å‹•",
    prerequisite: "",
    description: "æ”»æ“Šä¸­æœ‰ä¸€å®šæ©Ÿç‡ç™¼å‹•è‡´å‘½ä¸€æ“Šï¼Œ\nå¢åŠ å›ºå®šé¡å¤–å‚·å®³ã€‚",
    headers: ["æŠ€èƒ½ç­‰ç´š", "ç™¼å‹•ç‡", "çˆ†æ“Šé¡å¤–å‚·å®³"],
    levels: Array.from({ length: 20 }, (_, i) => [i + 1, `${2 * (i + 1)}%`, `${5 * (i + 1)}%`])
  },
  {
    name: "é›†ä¸­è¡“",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01004.png",
    max_level: 20,
    type: "ä¸»å‹•",
    prerequisite: "ç²¾æº–å¼·åŒ– LV3",
    description: "ä¸€å®šæ™‚é–“å…§å¢åŠ å‘½ä¸­èˆ‡è¿´é¿ç‡ã€‚",
    headers: ["æŠ€èƒ½ç­‰ç´š", "æ¶ˆè€—MP", "å‘½ä¸­ç‡", "è¿´é¿ç‡", "æŒçºŒæ™‚é–“"],
    levels: Array.from({ length: 20 }, (_, i) => {
      const mp = i < 10 ? 8 : 16;
      const val = i + 1;
      const time = 60 + val * 10;
      return [val, mp, `+${val}`, `+${val}`, `${time}ç§’`];
    })
  },
  {
    name: "æ–·é­‚ç®­",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01005.png",
    max_level: 20,
    type: "ä¸»å‹•",
    prerequisite: "",
    description: "ç™¼å°„å¼·åŠ›ç®­çŸ¢ï¼Œé€ æˆé«˜å‚·å®³ã€‚",
    headers: ["æŠ€èƒ½ç­‰ç´š", "æ¶ˆè€—MP", "æ”»æ“ŠåŠ›"],
    levels: Array.from({ length: 20 }, (_, i) => {
      const mp = 6 + Math.floor(i / 4);
      const atk = 141 + i * 5;
      return [i + 1, mp, `${atk}%`];
    })
  },
  {
    name: "äºŒé€£ç®­",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01006.png",
    max_level: 20,
    type: "ä¸»å‹•",
    prerequisite: "æ–·é­‚ç®­ LV1",
    description: "ä¸€æ¬¡ç™¼å°„å…©æç®­é€²è¡Œé›™é‡æ”»æ“Šã€‚",
    headers: ["æŠ€èƒ½ç­‰ç´š", "æ¶ˆè€—MP", "æ”»æ“ŠåŠ›"],
    levels: Array.from({ length: 20 }, (_, i) => {
      const mp = 8 + Math.floor(i / 2);
      const atk = 76 + i * 2;
      return [i + 1, mp, `${atk}%`];
    })
  }
];

const levels = {};
skills.forEach(skill => { levels[skill.name] = 0; });

function updatePoints() {
  const total = Object.values(levels).reduce((a, b) => a + b, 0);
  usedPoints = total;
  document.getElementById("points-remaining").innerText = MAX_POINTS - usedPoints;
  updateUnlockStatus(); // âœ… æ¯æ¬¡æ›´æ–°é»æ•¸ä¹Ÿæ›´æ–°è§£é–ç‹€æ…‹
}

function updateUnlockStatus() {
  skills.forEach(skill => {
    const [preSkill, preLevel] = skill.prerequisite?.match(/(.+?) LV(\d+)/)?.slice(1) || [];
    const unlocked = !preSkill || (levels[preSkill] >= parseInt(preLevel));
    const statusDiv = document.getElementById(`unlock-${skill.name}`);

    // å¦‚æœæœªè§£é–ä¸”æŠ€èƒ½ç­‰ç´šä¸ç‚º0ï¼Œè‡ªå‹•é‡ç½®ç‚º0
    if (!unlocked && levels[skill.name] !== 0) {
      levels[skill.name] = 0;
      // æ›´æ–°é¡¯ç¤ºç­‰ç´š
      document.getElementById(`level-${skill.name}`).innerText = `Lv. 0`;
      // ç§»é™¤é«˜äº®
      skill.levels.forEach((_, i) => {
        const row = document.getElementById(`row-${skill.name}-${i}`);
        if (row) row.classList.remove("highlight");
      });
    }

    if (statusDiv) {
      statusDiv.textContent = `[${unlocked ? "å·²è§£é–ğŸ”“" : "æœªè§£é–ğŸ”’"}]`;
      statusDiv.className = `unlock-status ${unlocked ? "unlocked" : "locked"}`;
    }
  });
}

function renderSkill(skill) {
  const [preSkill, preLevel] = skill.prerequisite?.match(/(.+?) LV(\d+)/)?.slice(1) || [];
  const isUnlocked = !preSkill || (levels[preSkill] >= parseInt(preLevel));
  const unlockHTML = preSkill
    ? `<div class="unlock-status ${isUnlocked ? 'unlocked' : 'locked'}" id="unlock-${skill.name}">
        [${isUnlocked ? "å·²è§£é–ğŸ”“" : "æœªè§£é–ğŸ”’"}]
      </div>` : "";

  return `
  <div class="skill">
    ${unlockHTML}
    <div class="skill-header">
      <img src="${skill.image}" alt="${skill.name}" />
      <h2>${skill.name}</h2>
    </div>
    <table class="meta-table">
      <tr>
        <td class="label">é¡å‹</td><td>${skill.type}</td>
        <td class="label">å‰ç½®æŠ€èƒ½</td><td colspan="2">${skill.prerequisite || "ç„¡"}</td>
      </tr>
      <tr class="effect-row">
        <td class="label">æŠ€èƒ½æ•ˆæœ</td>
        <td class="effect" colspan="4">${skill.description.replace(/\n/g, "<br>")}</td>
      </tr>
    </table>
    <div class="controls">
      <button onmousedown="startHold('${skill.name}', -1)" onmouseup="stopHold()" onmouseleave="stopHold()">-</button>
      <span id="level-${skill.name}">Lv. 0</span>
      <button onmousedown="startHold('${skill.name}', 1)" onmouseup="stopHold()" onmouseleave="stopHold()">+</button>
    </div>
    <table class="skill-table">
      <thead>
        <tr>${skill.headers.map(h => `<th>${h}</th>`).join('')}</tr>
      </thead>
      <tbody>
        ${skill.levels.map((row, i) =>
          `<tr id="row-${skill.name}-${i}">${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`
        ).join('')}
      </tbody>
    </table>
  </div>`;
}

function changeLevel(name, delta) {
  const skill = skills.find(s => s.name === name);
  if (!skill) return;

  let newLevel = levels[name] + delta;
  if (newLevel < 0 || newLevel > skill.max_level) return;

  const [reqSkill, reqLv] = skill.prerequisite?.match(/(.+?) LV(\d+)/)?.slice(1) || [];
  if (reqSkill && levels[reqSkill] < parseInt(reqLv)) {
    if (lastWarning !== name) {
      alert(`éœ€è¦å‰ç½®æŠ€èƒ½ã€Œ${reqSkill}ã€è‡³å°‘ç­‰ç´š ${reqLv}`);
      lastWarning = name;
    }
    return;
  }

  const totalAfterChange = Object.entries(levels).reduce((sum, [key, val]) => {
    return sum + (key === name ? newLevel : val);
  }, 0);

  if (totalAfterChange > MAX_POINTS) {
    if (lastWarning !== 'overflow') {
      alert(`å‰©é¤˜é»æ•¸ä¸è¶³ï¼Œæœ€å¤šåªèƒ½ä½¿ç”¨ ${MAX_POINTS} é»æŠ€èƒ½é»ï¼`);
      lastWarning = 'overflow';
    }
    return;
  }

  levels[name] = newLevel;

  document.getElementById(`level-${name}`).innerText = `Lv. ${newLevel}`;
  skill.levels.forEach((_, i) => {
    const row = document.getElementById(`row-${name}-${i}`);
    if (row) row.classList.toggle("highlight", i === newLevel - 1);
  });

  updatePoints();
}

let holdTimeout = null;
function startHold(name, delta) {
  changeLevel(name, delta);
  holdTimeout = setTimeout(() => {
    holdInterval = setInterval(() => changeLevel(name, delta), 100);
  }, 300);  // æŒ‰ä½300æ¯«ç§’å¾Œæ‰é–‹å§‹é‡è¤‡
}
function stopHold() {
  clearTimeout(holdTimeout);
  clearInterval(holdInterval);
  holdTimeout = null;
  holdInterval = null;
}

function renderAll() {
  document.getElementById("skills-container").innerHTML = skills.map(renderSkill).join('');
  updatePoints();
}
renderAll();
</script>
</body>
</html>
