<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>弓箭手技能模擬器</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
    }
    #points-left {
      font-size: 22px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 20px;
    }
    #points-left span {
      color: red;
    }
    .skill {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px #ccc;
      margin: 20px auto;
      max-width: 900px;
      padding: 20px;
    }
    .skill-header {
      display: flex;
      align-items: center;
    }
    .skill-header img {
      width: 64px;
      height: 64px;
      margin-right: 15px;
    }
    .skill-header h2 {
      margin: 0;
    }
    .skill-info {
      margin-top: 10px;
      font-size: 16px;
      font-weight: bold;
      background-color: #e6f5ff;
      padding: 6px 10px;
      border-radius: 6px;
    }
    .controls {
      margin-top: 15px;
    }
    button {
      font-size: 18px;
      padding: 5px 12px;
      margin: 0 5px;
      cursor: pointer;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 6px;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .desc {
      margin-top: 10px;
      font-size: 18px;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #bbb;
      padding: 6px;
      text-align: center;
    }
    thead tr {
      background-color: #eee5ff;
    }
    tr.highlight {
      background-color: #d4f0ff;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>弓箭手技能模擬器</h1>
  <div id="points-left">剩餘技能點數：<span id="points">61</span></div>
  <div id="skills-container"></div>

<script>
const MAX_POINTS = 61;
let holdInterval = null;

const skills = [
  {
    name: "精準強化",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01001.png",
    max_level: 16,
    type: "被動",
    prerequisite: "",
    description: "技能效果：增加命中率",
    headers: ["技能等級", "命中率"],
    levels: Array.from({ length: 16 }, (_, i) => [i + 1, `+${i + 1}`])
  },
  {
    name: "百步穿楊",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01002.png",
    max_level: 8,
    type: "被動",
    prerequisite: "精準強化x3",
    description: "技能效果：增加弓或弩弓的射程距離",
    headers: ["技能等級", "射程"],
    levels: Array.from({ length: 8 }, (_, i) => [i + 1, `${25 * (i + 1)}%`])
  },
  {
    name: "霸王箭",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01003.png",
    max_level: 20,
    type: "被動",
    prerequisite: "",
    description: "技能效果：攻擊中會有一定比例出現致命性一擊，增加固定額外傷害",
    headers: ["技能等級", "發動率", "爆擊額外傷害"],
    levels: Array.from({ length: 20 }, (_, i) => [i + 1, `${2 * (i + 1)}%`, `${5 * (i + 1)}%`])
  },
  {
    name: "集中術",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01004.png",
    max_level: 20,
    type: "主動",
    prerequisite: "精準強化x3",
    description: "技能效果：可在一定時間集中精神，增加命中率和迴避率。",
    headers: ["技能等級", "消耗MP", "命中率", "迴避率", "持續時間"],
    levels: Array.from({ length: 20 }, (_, i) => {
      const mp = i < 10 ? 8 : 16;
      const val = i + 1;
      const time = 70 + (i < 10 ? i * 10 : 100 + (i - 10) * 10);
      return [val, mp, `+${val}`, `+${val}`, `${time}秒`];
    })
  },
  {
    name: "斷魂箭",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01005.png",
    max_level: 20,
    type: "主動",
    prerequisite: "",
    description: "技能效果：發射強力的箭矢，對敵人造成較大的殺傷力。",
    headers: ["技能等級", "消耗MP", "攻擊力"],
    levels: Array.from({ length: 20 }, (_, i) => {
      const mp = Math.floor(i / 4) + 6;
      return [i + 1, mp, `${141 + i * 5}%`];
    })
  },
  {
    name: "二連箭",
    image: "https://maple.yampiz.com/maple/custom/skill/sk_01006.png",
    max_level: 20,
    type: "主動",
    prerequisite: "斷魂箭x1",
    description: "技能效果：一次射出兩枝箭，向怪物發動兩次攻擊。",
    headers: ["技能等級", "消耗MP", "攻擊力"],
    levels: Array.from({ length: 20 }, (_, i) => {
      const mp = Math.floor(i / 4) + 8;
      return [i + 1, mp, `${76 + i * 2}%`];
    })
  }
];

const levels = {};
skills.forEach(s => levels[s.name] = 0);

function getTotalPointsUsed() {
  return Object.values(levels).reduce((a, b) => a + b, 0);
}
function getPointsLeft() {
  return MAX_POINTS - getTotalPointsUsed();
}
function updatePointsLeftUI() {
  document.getElementById("points").innerText = getPointsLeft();
}

function renderSkill(skill) {
  let html = `
  <div class="skill">
    <div class="skill-header">
      <img src="${skill.image}" alt="${skill.name}" />
      <h2>${skill.name}</h2>
    </div>
    <div class="skill-info">
      類型：${skill.type}　前置技能：${skill.prerequisite || "無"}
    </div>
    <div class="desc">${skill.description}</div>
    <div class="controls">
      <button onmousedown="startHold('${skill.name}', -1)" onmouseup="stopHold()" onmouseleave="stopHold()">-</button>
      <span id="level-${skill.name}">Lv. 0</span>
      <button onmousedown="startHold('${skill.name}', 1)" onmouseup="stopHold()" onmouseleave="stopHold()">+</button>
    </div>
    <table>
      <thead>
        <tr>${skill.headers.map(h => `<th>${h}</th>`).join('')}</tr>
      </thead>
      <tbody>
        ${skill.levels.map((row, i) =>
          `<tr id="row-${skill.name}-${i}">${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`
        ).join('')}
      </tbody>
    </table>
  </div>`;
  return html;
}

function changeLevel(name, delta) {
  const skill = skills.find(s => s.name === name);
  if (!skill) return;
  let newLevel = Math.min(Math.max(levels[name] + delta, 0), skill.max_level);
  if (skill.prerequisite && newLevel > 0) {
    const [preName, preLv] = skill.prerequisite.split("x");
    if (levels[preName.trim()] < parseInt(preLv)) return;
  }
  const newTotal = getTotalPointsUsed() - levels[name] + newLevel;
  if (newTotal > MAX_POINTS) return;
  levels[name] = newLevel;
  document.getElementById(`level-${name}`).innerText = `Lv. ${newLevel}`;
  skill.levels.forEach((_, i) => {
    const row = document.getElementById(`row-${name}-${i}`);
    if (row) row.classList.toggle("highlight", i === newLevel - 1);
  });
  updatePointsLeftUI();
}

function startHold(name, delta) {
  changeLevel(name, delta);
  holdInterval = setInterval(() => changeLevel(name, delta), 150);
}
function stopHold() {
  clearInterval(holdInterval);
}

document.getElementById("skills-container").innerHTML = skills.map(renderSkill).join("");
updatePointsLeftUI();
</script>
</body>
</html>
